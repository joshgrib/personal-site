<!DOCTYPE html>
<html>
<head>
  <!-- Meta tags -->
  <meta charset="utf-8">
	<meta name="viewport" content="user-scalable=yes, width=device-width, initial-scale=1.0" />
	<meta name="author" content="Vladimir Carrer">
  <title>Loading...</title>
  <!-- Firebase hosting stuff -->
  <script defer src="/__/firebase/7.13.2/firebase-app.js"></script>
  <script defer src="/__/firebase/init.js"></script>
  <!-- Basic CSS styles -->
  <link rel="stylesheet" href="./basic.css">
  <!-- Overrides to basic CSS -->
  <style>
    :root{
      --c1:darkorange;
    }
    h1 {
      color: var(--c1);
    }
		main,footer {
			margin: 0 auto;
			width: 60%;
			text-align: left;
			padding: 0 20px;
		}
		section>section {
			color: #fff;
			background-color: var(--c1);
			padding: 15px;
			margin: 10px 8px 10px 8px;
			text-align: center;
		}
		@media (max-width: 481px) {
			main,footer {width: 98%}
			section,article {flex:none; width:100%; margin-left: 0;}
    }
    .spaced-out-column-items {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    #projects .spaced-out-column-items {
      min-width: 150px;
    }
    #work .spaced-out-column-items {
      min-width: 300px;
    }
  </style>
</head>
<body
  x-data="page()"
  x-init="initPage"
>
  <main>
    <header>
      <h1 x-text="title"></h1>
      <p>
        <!--TODO: add a real intro-->
        The plan is to make this a personal and portfolio site but I'm still
        setting it up.
      </p>
      <ul>
        <template x-for="section in sections">
          <li>
            <a :href="'#' + section.id" x-text="section.title"></a>
          </li>
        </template>
      </ul>
    </header>
    <template x-for="section in sections">
      <div :id="section.id">
        <a :href="'#' + section.id">
          <h2 x-text="section.title"></h2>
        </a>
        <section>
          <template x-for="item in section.items">
            <article class="spaced-out-column-items">
              <!-- Card title -->
              <h4>
                <template x-if="item.links">
                  <a :href="item.links[0][1]" x-text="item.title"></a>
                </template>
                <template x-if="!item.links">
                  <span x-text="item.title"></span>
                </template>
              </h4>
              <!-- Card body -->
              <p x-text="item.description"></p>
              <!-- Card footer -->
              <template x-if="item.date">
                <i x-text="item.date"></i>
              </template>
              <template x-if="item.links">
                <p>
                  <template x-for="link of item.links">
                    <a :href="link[1]" x-text="link[0]"></a>
                  </template>
                </p>
              </template>
            </article>
          </template>
        </section>
      </div>
    </template>
  </main>
  <footer>
    <p>
      <a href="https://github.com/joshgrib/personal-site" title="Github repo">
        Github repo
      </a>
      <code x-text="version"></code>
    </p>
  </footer>
  <script src="./alpine.min.js"></script>
</body>
<script>
  /**
   * Global methods
   */
  const fetchJson = async url => {
    let response = await fetch(url);
    let data = await response.json();
    return data;
  }

  const TEST_ITEM = {
    title: 'Full test item',
    description: 'An item with all properties in order to test, and a fairly lengthy description and list of links in order to test the sizing limits for stuff, hopefully this is sufficient verbosity to accomplish these stated goals',
    date: '2020-06-09',
    links: [
      ['Test', '#foo'],
      ['Link', '#bar'],
      ['Items', '#baz']
    ]
  }

  /**
   * Alpine model
   */
  function page () {
    return {
      title: 'josh.software',
      version: `v0.4.2`,
      sections: [
        {
          id: 'projects',
          title: 'Projects & Profiles',
          items: [{ title: 'Loading...' }]
        }, {
          id: 'work',
          title: 'Work Experience',
          items: [{ title: 'Loading...' }]
        }
      ],
      _setItems (sectionId) {
        return items => {
          items = [TEST_ITEM, TEST_ITEM, TEST_ITEM, TEST_ITEM, ...items]
          this.sections.filter(s => s.id === sectionId).map(s => s.items = items)
        }
      },
      _handleError (sectionId) {
        return e => {
          const msgItems = [{
            title: 'Error loading content',
            description: e.message
          }]
          this._setItems(sectionId)(msgItems)
        }
      },
      initPage () {
        document.title = this.title
        const loadSection = id => fetchJson(`/data/${id}.json`)
          .then(this._setItems(id))
          .catch(this._handleError(id))
        loadSection('projects')
        loadSection('work')
      }
    }
  }
</script>
</html>
